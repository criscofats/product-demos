---

# - name: Create Service and Route for our Apache Webserver
#   hosts: localhost
#   tasks:

- name: Create webapp service
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: "{{ service_name }}"
        namespace: "{{ vm_namespace }}"
      spec:
        selector:
          env: "{{ vm_application }}"
        ports:
          - protocol: TCP
            port: 80
            targetPort: 80

- name: Create webapp route
  kubernetes.core.k8s:
    state: present
    definition: 
      kind: Route
      apiVersion: route.openshift.io/v1
      metadata:
        name: "{{ route_name }}"
        namespace: "{{ vm_namespace }}"
        labels: {}
      spec:
        to:
          kind: Service
          name: "{{ service_name }}"
        tls:
          termination: edge
          insecureEdgeTerminationPolicy: Redirect
        wildcardPolicy: None
        port:
          targetPort: 80

# - name: Fetch route info
#   kubernetes.core.k8s:
#     api_version: v1
#     kind: Route
#     name: webapp-route
#     namespace: summit-edu
#   register: route_info

# - name: Print webapp route info
#   ansible.builtin.debug:
#     msg: "{{ route_info.result.spec.host }}"
